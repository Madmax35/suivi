<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Suivi Followers Instagram - KX CHR</title>
<style>
  body {
    background: #121212;
    color: #ddd;
    font-family: Arial, sans-serif;
    margin: 0; padding: 20px;
    display: flex; justify-content: center;
  }
  .container {
    max-width: 600px; width: 100%;
    background: #1e1e1e;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 0 20px #555;
    text-align: center;
  }
  input, button {
    font-size: 1rem;
    padding: 0.6em 1em;
    border-radius: 8px;
    border: none;
    margin: 0.5em 0.2em;
  }
  input {
    width: 140px;
    color: #222;
  }
  button {
    background: #444;
    color: #ddd;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #666;
  }
  #shareLink {
    margin-top: 15px;
    word-break: break-all;
    background: #222;
    padding: 10px;
    border-radius: 8px;
    user-select: all;
  }
  canvas {
    margin: 10px auto;
    border-radius: 12px;
    background: #222;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>KX CHR Followers Instagram</h1>

    <input id="followersInput" type="number" placeholder="Nombre d'abonnés" />
    <button id="addFollowerBtn">Ajouter</button>
    <button id="shareBtn">Partagez</button>

    <ul id="followersHistory" style="text-align:left; max-height: 150px; overflow-y: auto; margin-top: 20px;"></ul>
    <canvas id="followersChart" width="400" height="200"></canvas>
    
    <div id="shareLink" style="display:none;"></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const followersData = [
  { date: "2025-05-10", followers: 24000 },
  { date: "2025-06-01", followers: 29000 },
  { date: "2025-07-01", followers: 35300 },
  { date: "2025-07-28", followers: 35300 },
  { date: "2025-08-04", followers: 36700 },
  { date: "2025-08-05", followers: 36983 },
  { date: "2025-08-06", followers: 37267 },
  { date: "2025-08-07", followers: 37550 },
  { date: "2025-08-08", followers: 37750 },
  { date: "2025-08-09", followers: 37706 },
  { date: "2025-08-10", followers: 37817 }
];

const ctx = document.getElementById("followersChart").getContext("2d");
let chart;

function formatDate(d) {
  const dt = new Date(d);
  return dt.toLocaleDateString("fr-FR", { day: "2-digit", month: "2-digit" });
}

function updateHistory() {
  const ul = document.getElementById("followersHistory");
  ul.innerHTML = "";
  followersData.slice().reverse().forEach(e => {
    const li = document.createElement("li");
    li.textContent = `${formatDate(e.date)} : ${e.followers.toLocaleString()} abonnés`;
    ul.appendChild(li);
  });
}

function updateChart() {
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: followersData.map(e => formatDate(e.date)),
      datasets: [{
        label: "Followers",
        data: followersData.map(e => e.followers),
        borderColor: "#ddd",
        backgroundColor: "rgba(221,221,221,0.3)",
        fill: true,
        tension: 0.3,
        borderWidth: 2,
        pointRadius: 3,
        pointHoverRadius: 6
      }]
    },
    options: {responsive:true, maintainAspectRatio:false}
  });
}

function addFollower(val) {
  const today = new Date().toISOString().slice(0,10);
  const idx = followersData.findIndex(d => d.date === today);
  if (idx !== -1) followersData[idx].followers = val;
  else followersData.push({date: today, followers: val});
  followersData.sort((a,b) => new Date(a.date) - new Date(b.date));
  updateHistory();
  updateChart();
}

function generateShareImage() {
  // Crée un canvas temporaire pour l’image de partage
  const canvas = document.createElement("canvas");
  canvas.width = 600;
  canvas.height = 300;
  const ctx = canvas.getContext("2d");

  // Fond
  ctx.fillStyle = "#121212";
  ctx.fillRect(0,0,canvas.width, canvas.height);

  // Titre
  ctx.fillStyle = "#ddd";
  ctx.font = "24px Arial";
  ctx.fillText("KX CHR Followers Summary", 20, 40);

  // Dernière date et valeur
  const last = followersData[followersData.length-1];
  ctx.font = "20px Arial";
  ctx.fillText(`Date : ${formatDate(last.date)}`, 20, 90);
  ctx.fillText(`Followers : ${last.followers.toLocaleString()}`, 20, 130);

  // Gain total
  const gain = last.followers - followersData[0].followers;
  ctx.fillText(`Gain total : ${gain.toLocaleString()}`, 20, 170);

  return canvas.toDataURL("image/png");
}

document.getElementById("addFollowerBtn").addEventListener("click", () => {
  const val = parseInt(document.getElementById("followersInput").value);
  if (isNaN(val) || val <= 0) {
    alert("Merci d'entrer un nombre valide");
    return;
  }
  addFollower(val);
  document.getElementById("followersInput").value = "";
});

document.getElementById("shareBtn").addEventListener("click", () => {
  const imgData = generateShareImage();
  const shareDiv = document.getElementById("shareLink");
  shareDiv.style.display = "block";
  shareDiv.innerHTML = `<img src="${imgData}" alt="Résumé KX CHR Followers" style="max-width:100%; border-radius:12px;"/>` +
    `<p>Copie ce lien et partage-le :</p>` +
    `<input type="text" style="width:100%; font-size: 0.9em;" readonly value="data:image/png;base64,${imgData.split(",")[1]}" />`;
});

window.onload = () => {
  updateHistory();
  updateChart();
};
</script>
</body>
</html>
