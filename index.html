<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Suivi Followers Instagram - KX CHR</title>
<style>
  body {
    margin: 0; background: #121212; color: #ddd;
    font-family: Arial, sans-serif;
    display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px;
  }
  .container {
    max-width: 900px; width: 100%;
    background: #1e1e1e; border-radius: 15px; padding: 20px;
    box-shadow: 0 0 20px #666;
  }
  h1 {
    text-align: center; color: #ccc; margin-bottom: 20px;
    font-weight: normal;
  }
  .profile {
    width: 120px; height: 120px; border-radius: 50%; overflow: hidden; margin: 0 auto 20px;
    border: 3px solid #666;
  }
  .profile img {
    width: 100%; height: 100%; object-fit: cover;
  }
  .btn-group {
    display: flex; justify-content: center; gap: 15px; margin-bottom: 15px;
  }
  .btn {
    padding: 8px 18px;
    border-radius: 8px;
    background: #333;
    color: #ddd;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
    user-select: none;
  }
  .btn.active, .btn:hover {
    background: #555;
  }
  #followersInput {
    width: calc(100% - 100px);
    padding: 10px; border-radius: 8px; border: none; font-size: 16px; color: #222;
    outline: none;
  }
  #addFollowerBtn {
    width: 90px; background: #444; color: #ddd; border: none; border-radius: 8px;
    font-weight: bold; font-size: 16px; cursor: pointer; margin-left: 10px;
    transition: background 0.3s ease;
  }
  #addFollowerBtn:hover {
    background: #666;
  }
  #followersHistory {
    margin-top: 20px; max-height: 160px; overflow-y: auto;
    border: 1px solid #444; border-radius: 8px; padding: 10px;
    background: #222; font-size: 14px;
    color: #ccc;
  }
  #followersHistory li {
    display: flex; justify-content: space-between; padding: 4px 0;
    border-bottom: 1px solid #333;
  }
  #followersHistory li:last-child {
    border-bottom: none;
  }
  canvas {
    display: block; width: 100%; max-height: 350px; margin-top: 20px;
  }
  .stats {
    margin-top: 15px; font-weight: bold; font-size: 16px;
    color: #bbb;
    text-align: center;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>KX CHR Followers Instagram</h1>
    <div class="profile"><img src="profile.jpg" alt="KX CHR Profile" /></div>
    <div class="btn-group">
      <button class="btn active" data-range="7">1 semaine</button>
      <button class="btn" data-range="30">1 mois</button>
      <button class="btn" data-range="365">1 an</button>
    </div>
    <div>
      <input id="followersInput" type="number" placeholder="Nombre d'abonnés aujourd'hui" />
      <button id="addFollowerBtn">Ajouter</button>
    </div>
    <ul id="followersHistory"></ul>
    <canvas id="followersChart"></canvas>
    <div class="stats" id="statsContainer"></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
<script>
const estimationData = [
  { date: "2025-01-01", followers: 15000 },
  { date: "2025-01-15", followers: 16000 },
  { date: "2025-02-01", followers: 18000 },
  { date: "2025-02-15", followers: 19500 },
  { date: "2025-03-01", followers: 21000 },
  { date: "2025-03-15", followers: 22000 },
  { date: "2025-04-01", followers: 25000 },
  { date: "2025-04-15", followers: 27000 },
  { date: "2025-05-01", followers: 31000 },
  { date: "2025-05-15", followers: 31500 },
  { date: "2025-06-01", followers: 32000 },
  { date: "2025-06-15", followers: 33000 },
  { date: "2025-07-01", followers: 33700 },
  { date: "2025-07-15", followers: 34800 },
  { date: "2025-07-28", followers: 35300 },
  { date: "2025-07-29", followers: 35500 },
  { date: "2025-07-30", followers: 35700 },
  { date: "2025-07-31", followers: 35900 },
  { date: "2025-08-01", followers: 36100 },
  { date: "2025-08-02", followers: 36300 },
  { date: "2025-08-03", followers: 36500 },
  { date: "2025-08-04", followers: 36700 },
  { date: "2025-08-05", followers: 36983 },
  { date: "2025-08-06", followers: 37267 },
  { date: "2025-08-07", followers: 37550 },
  { date: "2025-08-08", followers: 37750 },
  { date: "2025-08-09", followers: 38000 }
];

let followersData = JSON.parse(localStorage.getItem("followersData")) || estimationData.slice();

let currentRange = 7;

function formatDate(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString("fr-FR", { day: "2-digit", month: "2-digit", year: "2-digit" });
}

function sigmoid(x) {
  return 1 / (1 + Math.exp(-x));
}

function makeProjectionSigmoid(data, days = 365, maxFollowers = 50000) {
  if (!data.length) return [];
  const lastEntry = data[data.length - 1];
  const startFollowers = lastEntry.followers;
  const startDate = new Date(lastEntry.date);
  const x0 = days / 2;
  const k = 0.03;
  let projections = [];
  const f0 = sigmoid(-x0 * k);
  const fMax = sigmoid((days - x0) * k);
  for (let i = 1; i <= days; i++) {
    const projDate = new Date(startDate);
    projDate.setDate(projDate.getDate() + i);
    const s = sigmoid(k * (i - x0));
    const normS = (s - f0) / (fMax - f0);
    const followers = startFollowers + normS * (maxFollowers - startFollowers);
    projections.push({
      date: projDate.toISOString().slice(0, 10),
      followers: Math.round(followers),
    });
  }
  return projections;
}

function addFollowerEntry(followers) {
  if (!followers || isNaN(followers) || followers <= 0) {
    alert("Merci d'entrer un nombre valide.");
    return;
  }
  const todayStr = new Date().toISOString().slice(0, 10);
  const existingIndex = followersData.findIndex((d) => d.date === todayStr);
  if (existingIndex >= 0) {
    followersData[existingIndex].followers = followers;
  } else {
    followersData.push({ date: todayStr, followers });
  }
  followersData.sort((a, b) => new Date(a.date) - new Date(b.date));
  localStorage.setItem("followersData", JSON.stringify(followersData));
  renderHistory();
  updateStats();
  updateChart(currentRange);
}

function renderHistory() {
  const ul = document.getElementById("followersHistory");
  ul.innerHTML = "";
  followersData
    .slice()
    .reverse()
    .forEach((entry) => {
      const li = document.createElement("li");
      li.textContent = formatDate(entry.date);
      const span = document.createElement("span");
      span.textContent = entry.followers.toLocaleString("fr-FR");
      li.appendChild(span);
      ul.appendChild(li);
    });
}

function calculateStats() {
  const endDate = new Date();
  const startDate = new Date();
  startDate.setDate(endDate.getDate() - currentRange);

  const filteredFollowers = followersData.filter(d => {
    const dt = new Date(d.date);
    return dt >= startDate && dt <= endDate;
  });

  if (filteredFollowers.length < 2) return { gain: 0 };

  const gain = filteredFollowers[filteredFollowers.length - 1].followers - filteredFollowers[0].followers;

  return { gain };
}

function updateStats() {
  const stats = calculateStats();
  const container = document.getElementById("statsContainer");
  container.innerHTML = `
    <div>Gain total abonnés sur la période (${currentRange} jours) : <strong>${stats.gain.toLocaleString('fr-FR')}</strong></div>
  `;
}

const ctx = document.getElementById("followersChart").getContext("2d");
let followersChart;

function updateChart(rangeDays) {
  if(rangeDays) currentRange = rangeDays;

  const projectionDataObj = makeProjectionSigmoid(followersData, 365, 50000);

  const endDate = new Date();
  const startDate = new Date();
  startDate.setDate(endDate.getDate() - currentRange);

  const allDatesSet = new Set();
  followersData.forEach(d => allDatesSet.add(d.date));
  projectionDataObj.forEach(d => allDatesSet.add(d.date));

  const filteredDates = Array.from(allDatesSet)
    .filter(d => {
      const dt = new Date(d);
      return dt >= startDate && dt <= endDate;
    })
    .sort((a, b) => new Date(a) - new Date(b));

  function mapDataToLabels(data, labels) {
    const map = new Map(data.map(d => [d.date, d.followers]));
    return labels.map(label => map.get(label) ?? null);
  }

  const filteredFollowers = followersData.filter(d => {
    const dt = new Date(d.date);
    return dt >= startDate && dt <= endDate;
  });

  const realDataset = mapDataToLabels(filteredFollowers, filteredDates);
  const projDataset = mapDataToLabels(projectionDataObj, filteredDates);

  if(followersChart) followersChart.destroy();
  followersChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: filteredDates.map(d => {
        const dateObj = new Date(d);
        return dateObj.toLocaleDateString("fr-FR", { day: "2-digit", month: "2-digit" });
      }),
      datasets: [
        {
          label: "Followers Réels",
          data: realDataset,
          borderColor: "#ddd",
          backgroundColor: "rgba(221, 221, 221, 0.3)",
          fill: true,
          tension: 0.3,
          borderWidth: 3,
          pointRadius: 3,
          pointHoverRadius: 6,
        },
        {
          label: "Projection 12 mois",
          data: projDataset,
          borderColor: "#999",
          backgroundColor: "rgba(153, 153, 153, 0.15)",
          fill: true,
          borderDash: [8, 6],
          tension: 0.3,
          borderWidth: 2,
          pointRadius: 0,
        },
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        mode: 'index',
        intersect: false,
      },
      plugins: {
        legend: {
          labels: {
            color: '#ccc',
            font: { weight: '600', size: 14 }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0,0,0,0.7)',
          titleColor: '#ddd',
          bodyColor: '#eee'
        },
        zoom: {
          pan: {
            enabled: true,
            mode: 'x',
            modifierKey: 'ctrl',
          },
          zoom: {
            wheel: {
              enabled: true,
            },
            pinch: {
              enabled: true
            },
            mode: 'x',
          }
        }
      },
      scales: {
        x: {
          ticks: { color: '#aaa' },
          grid: { color: 'rgba(255,255,255,0.05)' }
        },
        y: {
          beginAtZero: false,
          ticks: { color: '#aaa' },
          grid: { color: 'rgba(255,255,255,0.1)' }
        }
      }
    },
    plugins: [ChartZoom]
  });
}

renderHistory();
updateChart();
updateStats();

document.getElementById("addFollowerBtn").addEventListener("click", () => {
  const val = parseInt(document.getElementById("followersInput").value);
  addFollowerEntry(val);
  document.getElementById("followersInput").value = "";
});

document.querySelectorAll(".btn").forEach(btn => {
  btn.addEventListener("click", e => {
    document.querySelectorAll(".btn").forEach(b => b.classList.remove("active"));
    e.target.classList.add("active");
    updateChart(parseInt(e.target.dataset.range));
    updateStats();
  });
});

document.getElementById("followersInput").addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    document.getElementById("addFollowerBtn").click();
  }
});
</script>
</body>
</html>
